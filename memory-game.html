<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©</title>
<style>
body{
    font-family:Arial;
    text-align:center;
    background:#f0f0f0;
    margin:0;
    padding:20px
}
button{
    padding:10px 18px;
    font-size:16px;
    cursor:pointer;
    margin:5px
}
#gameBoard{
    margin-top:20px;
    display:grid;
    gap:10px;
    justify-content:center
}
.card{
    width:80px;
    height:80px;
    background:#4CAF50;
    color:white;
    font-size:24px;
    line-height:80px;
    cursor:pointer;
    user-select:none
}
.hidden{
    background:#ccc;
    color:#ccc
}
#timer{
    font-size:20px;
    margin-top:10px
}
#message{
    font-size:24px;
    margin-top:20px
}
.back{
    background:#333;
    color:#fff;
    border:none;
    border-radius:8px
}
</style>
</head>
<body>

<button class="back" onclick="window.location.href='index.html'">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>

<h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h2>
<div id="difficultyChoice">
    <button onclick="setDifficulty('easy')">Ø³Ù‡Ù„</button>
    <button onclick="setDifficulty('hard')">ØµØ¹Ø¨</button>
</div>

<button id="startBtn" onclick="startGame()" style="display:none">Ø§Ø¨Ø¯Ø£</button>

<div id="timer"></div>
<div id="gameBoard"></div>
<div id="message"></div>

<script>
let difficulty="";
let cards=[];
let first=null, second=null, lock=false;
let matches=0, totalPairs=0;
let startTime, timerInterval;

function setDifficulty(level){
    difficulty=level;
    const count = level==="easy"?16:30;
    totalPairs = count/2;
    cards = shuffle([...Array(totalPairs).keys()].map(i=>i+1).flatMap(n=>[n,n]));
    document.getElementById("difficultyChoice").style.display="none";
    document.getElementById("startBtn").style.display="inline-block";
}

function shuffle(a){return a.sort(()=>Math.random()-0.5)}

function startGame(){
    startBtn.style.display="none";
    gameBoard.innerHTML="";
    matches=0;
    first=second=null;
    lock=false;

    const cols = difficulty==="easy"?4:6;
    gameBoard.style.gridTemplateColumns=`repeat(${cols},80px)`;

    cards.forEach(n=>{
        const c=document.createElement("div");
        c.className="card hidden";
        c.dataset.num=n;
        c.onclick=()=>flip(c);
        gameBoard.appendChild(c);
    });

    startTime=Date.now();
    timerInterval=setInterval(updateTimer,1000);
}

function updateTimer(){
    const t=Math.floor((Date.now()-startTime)/1000);
    timer.innerText="â±ï¸ Ø§Ù„ÙˆÙ‚Øª: "+t+" Ø«Ø§Ù†ÙŠØ©";
}

function flip(card){
    if(lock || !card.classList.contains("hidden"))return;
    card.classList.remove("hidden");
    card.innerText=card.dataset.num;

    if(!first){ first=card; return; }
    second=card;
    lock=true;

    setTimeout(checkMatch,600);
}

function checkMatch(){
    if(first.dataset.num===second.dataset.num){
        matches++;
        if(matches===totalPairs) endGame();
    }else{
        first.classList.add("hidden");
        second.classList.add("hidden");
        first.innerText=second.innerText="";
    }
    first=second=null;
    lock=false;
}

function endGame(){
    clearInterval(timerInterval);
    const time=Math.floor((Date.now()-startTime)/1000);

    let msg="";
    if(time<=40) msg="Ø­ÙŠÙ‘ Ø¹ÙŠÙ†Ùƒ ğŸ”¥";
    else if(time<=60) msg="Ø·ÙˆÙ‘Ù„Øª Ø´ÙˆÙŠ ğŸ˜…";
    else msg="Ø·ÙˆÙ‘Ù„Øª ÙŠØ§ Ø£Ø®ÙŠ Ø¬Ø§Ù†Ø§ Ø§Ù„Ù†ÙˆÙ… ğŸ˜´";

    message.innerText=msg+" â€” ÙˆÙ‚ØªÙƒ: "+time+" Ø«Ø§Ù†ÙŠØ©";

    /* ğŸ’¾ localStorage */
    localStorage.setItem("lastScore", time);

    let best = localStorage.getItem("bestMemory");
    if(!best || time < best) localStorage.setItem("bestMemory", time);

    localStorage.setItem("memoryScore", time);
    localStorage.setItem("tries", Number(localStorage.getItem("tries")||0)+1);

    let history = JSON.parse(localStorage.getItem("history")||"[]");
    history.push("ğŸƒ Ø°Ø§ÙƒØ±Ø©: "+time+" Ø«Ø§Ù†ÙŠØ©");
    localStorage.setItem("history", JSON.stringify(history));
}
</script>

</body>
</html>
